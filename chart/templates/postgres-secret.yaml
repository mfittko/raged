{{- if not .Values.postgres.password }}
{{- fail "postgres.password must be set. Please provide a secure password via --set postgres.password=<value>" }}
{{- end }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Release.Name }}-postgres-secret
  labels:
    {{- include "rag.labels" . | nindent 4 }}
type: Opaque
stringData:
  POSTGRES_USER: "{{ .Values.postgres.user }}"
  POSTGRES_PASSWORD: "{{ .Values.postgres.password }}"
  # urlquery encodes special characters (@, :, /, #, etc.) for safe use in connection strings.
  # Note: Spaces are encoded as '+' (form encoding), which PostgreSQL clients accept.
  # For production, use passwords without spaces (e.g., randomly generated alphanumeric+symbols).
  DATABASE_URL: "postgresql://{{ urlquery .Values.postgres.user }}:{{ urlquery .Values.postgres.password }}@{{ .Release.Name }}-postgres:{{ .Values.postgres.service.port }}/{{ urlquery .Values.postgres.database }}"
