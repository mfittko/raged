{{- if .Values.enrichment.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-worker-config
  labels:
    {{- include "rag.labels" . | nindent 4 }}
{{- if not .Values.migration.allowBrokenLegacyRuntime }}
{{- fail "migration.allowBrokenLegacyRuntime=false: worker runtime migration is incomplete. Set migration.allowBrokenLegacyRuntime=true only as an explicit temporary override." }}
{{- end }}
data:
  # Legacy env vars for temporary migration mode (explicit opt-in required)
  # These localhost endpoints are intentionally temporary and not production-safe.
  REDIS_URL: "redis://localhost:6379"
  QDRANT_URL: "http://localhost:6333"
  NEO4J_URL: "bolt://localhost:7687"
  NEO4J_USER: "neo4j"
  OLLAMA_URL: "http://{{ .Release.Name }}-ollama:{{ .Values.ollama.service.port }}"
  EXTRACTOR_PROVIDER: "{{ .Values.enrichment.worker.extractor.provider }}"
  EXTRACTOR_MODEL_FAST: "{{ .Values.enrichment.worker.extractor.modelFast }}"
  EXTRACTOR_MODEL_CAPABLE: "{{ .Values.enrichment.worker.extractor.modelCapable }}"
  EXTRACTOR_MODEL_VISION: "{{ .Values.enrichment.worker.extractor.modelVision }}"
  WORKER_CONCURRENCY: "{{ .Values.enrichment.worker.concurrency }}"
{{- end }}
